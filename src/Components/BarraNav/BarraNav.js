import React, { useEffect, useState } from "react";
import Form from "react-bootstrap/Form";
import Button from "react-bootstrap/Button";
import "./Style.scss";
import { BarraCategoria } from "../BarraCategoria/BarraCategoria";
import Container from "react-bootstrap/Container";
import Nav from "react-bootstrap/Nav";
import Navbar from "react-bootstrap/Navbar";
import { useLocation } from "react-router-dom";
import NavDropdown from "react-bootstrap/NavDropdown";
import { useCarrinho } from "../../Contexts/CarrinhoContext";

export const NavBar = () => {
  const carrinho = useCarrinho();
  const location = useLocation();
  const [lupaAberta, setLupaAberta] = useState(false);
  const [usuarioLogado, setUsuarioLogado] = useState(false);
  const [adminLogado, setAdminLogado] = useState(false);

  let teste = 0;

  function toogleLupa() {
    setLupaAberta(!lupaAberta);
  }

  const contadorTotalCarrinho = Object.keys(carrinho.carrinho).reduce(
    (prev, curr) => {
      // teste += carrinho.carrinho[curr].quantidade;
      return prev + +carrinho.carrinho[curr].quantidade;
    },
    0
  );

  useEffect(() => {
    const usuario = JSON.parse(window.localStorage.getItem("usuario"));
    if (usuario) {
      setUsuarioLogado(true);
      console.log(usuario);
      if (usuario.admin == true) {
        setAdminLogado(true);
      } else {
        setAdminLogado(false);
      }
    } else {
      setUsuarioLogado(false);
    }
  }, [location]);

  const deslogar = () => {
    window.localStorage.removeItem("usuario");
  };
  return (
    <>
      <Navbar bg="primary" variant="dark" expand="lg">
        <Container className="container-nav">
          <Navbar.Brand href="/">
            <svg
              width="309"
              height="80"
              viewBox="0 0 309 80"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M118.129 55.0077V57.8023C118.129 59.206 117.954 60.4609 117.605 61.5671C117.259 62.6733 116.79 63.6485 116.198 64.4926C115.606 65.3368 114.924 66.0597 114.151 66.6613C113.375 67.2597 112.564 67.7497 111.72 68.1314C110.876 68.5098 110.024 68.7863 109.163 68.961C108.303 69.1324 107.493 69.2181 106.733 69.2181H92.8036V63.0614H106.733C107.522 62.9967 108.237 62.835 108.877 62.5763C109.517 62.3143 110.066 61.9617 110.522 61.5186C110.981 61.0787 111.337 60.5467 111.589 59.9224C111.841 59.2982 111.968 58.5914 111.968 57.8023V55.0077C111.89 54.2315 111.725 53.5199 111.473 52.873C111.22 52.2261 110.876 51.673 110.439 51.2137C110.006 50.7577 109.482 50.3987 108.867 50.1367C108.25 49.8779 107.538 49.7486 106.733 49.7486H92.8521C92.0306 49.7486 91.4064 49.9604 90.9794 50.3841C90.5525 50.8111 90.339 51.4272 90.339 52.2326V77.5581H84.1823V52.2326C84.1823 50.6542 84.4702 49.3119 85.0459 48.2057C85.6216 47.0996 86.3396 46.2069 87.2 45.5276C88.0603 44.8484 88.9967 44.3552 90.0091 44.0479C91.0182 43.7406 91.9497 43.587 92.8036 43.587H106.733C108.123 43.587 109.372 43.7649 110.478 44.1207C111.581 44.4765 112.556 44.9503 113.404 45.5422C114.248 46.1341 114.966 46.8166 115.558 47.5896C116.15 48.3626 116.64 49.1728 117.028 50.0202C117.413 50.8644 117.692 51.7167 117.867 52.5771C118.042 53.4374 118.129 54.2476 118.129 55.0077ZM148.357 60.4318V69.0774C148.357 69.9313 148.206 70.8515 147.905 71.838C147.605 72.8245 147.119 73.7398 146.45 74.584C145.777 75.4282 144.901 76.1349 143.82 76.7042C142.737 77.2734 141.422 77.5581 139.876 77.5581H128.766C127.912 77.5581 126.992 77.4077 126.005 77.1069C125.019 76.8061 124.103 76.3209 123.259 75.6514C122.412 74.9786 121.705 74.1021 121.139 73.0218C120.57 71.9383 120.285 70.6235 120.285 69.0774C120.285 68.2235 120.436 67.3001 120.736 66.3072C121.034 65.3109 121.519 64.3908 122.192 63.5466C122.861 62.7024 123.738 61.9957 124.821 61.4264C125.902 60.8572 127.216 60.5725 128.766 60.5725H139.876V66.4478H128.766C127.928 66.4478 127.28 66.705 126.82 67.2193C126.364 67.7303 126.136 68.3659 126.136 69.1259C126.136 69.9313 126.4 70.5588 126.927 71.0084C127.457 71.458 128.087 71.6828 128.814 71.6828H139.876C140.714 71.6828 141.361 71.4305 141.817 70.9259C142.276 70.4213 142.506 69.789 142.506 69.0289V60.4318C142.506 59.6265 142.257 58.986 141.758 58.5106C141.26 58.0384 140.633 57.8023 139.876 57.8023H126.35V51.9512H139.876C140.73 51.9512 141.65 52.1 142.637 52.3975C143.623 52.6983 144.538 53.1851 145.383 53.8579C146.227 54.5274 146.933 55.4039 147.503 56.4875C148.072 57.5678 148.357 58.8825 148.357 60.4318ZM178.37 68.9125C178.37 69.9701 178.236 70.921 177.967 71.7652C177.699 72.6094 177.344 73.3517 176.905 73.9921C176.461 74.6325 175.947 75.1775 175.362 75.6271C174.776 76.0767 174.165 76.4438 173.528 76.7284C172.887 77.0131 172.239 77.2217 171.582 77.3543C170.929 77.4901 170.31 77.5581 169.724 77.5581H153.049V71.3965H169.676C170.513 71.3965 171.146 71.1847 171.573 70.7609C172 70.334 172.213 69.7178 172.213 68.9125C172.132 67.2694 171.303 66.4478 169.724 66.4478H160.176C158.818 66.4478 157.665 66.2101 156.717 65.7347C155.769 65.2624 154.999 64.6705 154.408 63.959C153.816 63.2506 153.39 62.4857 153.132 61.6641C152.87 60.8426 152.739 60.076 152.739 59.3645C152.739 57.9898 152.983 56.8335 153.471 55.8956C153.963 54.9543 154.579 54.191 155.32 53.6056C156.064 53.0234 156.869 52.6013 157.736 52.3393C158.606 52.0806 159.419 51.9512 160.176 51.9512H175.313V58.1079H160.225C159.908 58.1079 159.659 58.1435 159.478 58.2146C159.296 58.2858 159.162 58.3812 159.075 58.5009C158.988 58.6173 158.936 58.7435 158.92 58.8793C158.907 59.0119 158.9 59.1413 158.9 59.2674C158.913 59.523 158.96 59.7219 159.041 59.8642C159.119 60.0033 159.217 60.1052 159.337 60.1698C159.457 60.2345 159.591 60.2701 159.74 60.2766C159.888 60.2831 160.034 60.2863 160.176 60.2863H169.724C171.303 60.2863 172.645 60.5709 173.751 61.1402C174.857 61.7094 175.75 62.4242 176.429 63.2846C177.108 64.1449 177.602 65.0813 177.909 66.0937C178.216 67.1028 178.37 68.0424 178.37 68.9125ZM207.437 68.9125C207.437 69.9701 207.303 70.921 207.034 71.7652C206.766 72.6094 206.412 73.3517 205.972 73.9921C205.529 74.6325 205.014 75.1775 204.429 75.6271C203.843 76.0767 203.232 76.4438 202.595 76.7284C201.955 77.0131 201.306 77.2217 200.649 77.3543C199.996 77.4901 199.377 77.5581 198.791 77.5581H182.116V71.3965H198.743C199.58 71.3965 200.213 71.1847 200.64 70.7609C201.067 70.334 201.28 69.7178 201.28 68.9125C201.199 67.2694 200.37 66.4478 198.791 66.4478H189.243C187.885 66.4478 186.732 66.2101 185.784 65.7347C184.836 65.2624 184.067 64.6705 183.475 63.959C182.883 63.2506 182.457 62.4857 182.199 61.6641C181.937 60.8426 181.806 60.076 181.806 59.3645C181.806 57.9898 182.05 56.8335 182.538 55.8956C183.03 54.9543 183.646 54.191 184.387 53.6056C185.131 53.0234 185.936 52.6013 186.803 52.3393C187.673 52.0806 188.486 51.9512 189.243 51.9512H204.38V58.1079H189.292C188.975 58.1079 188.726 58.1435 188.545 58.2146C188.364 58.2858 188.229 58.3812 188.142 58.5009C188.055 58.6173 188.003 58.7435 187.987 58.8793C187.974 59.0119 187.967 59.1413 187.967 59.2674C187.98 59.523 188.027 59.7219 188.108 59.8642C188.186 60.0033 188.284 60.1052 188.404 60.1698C188.524 60.2345 188.658 60.2701 188.807 60.2766C188.955 60.2831 189.101 60.2863 189.243 60.2863H198.791C200.37 60.2863 201.712 60.5709 202.818 61.1402C203.924 61.7094 204.817 62.4242 205.496 63.2846C206.175 64.1449 206.669 65.0813 206.976 66.0937C207.283 67.1028 207.437 68.0424 207.437 68.9125ZM239.609 60.5725V68.9125C239.609 69.9701 239.475 70.921 239.206 71.7652C238.938 72.6094 238.582 73.3517 238.139 73.9921C237.696 74.6325 237.183 75.1775 236.601 75.6271C236.016 76.0767 235.403 76.4438 234.762 76.7284C234.125 77.0131 233.478 77.2217 232.822 77.3543C232.165 77.4901 231.546 77.5581 230.963 77.5581H219.853C218.999 77.5581 218.066 77.4077 217.054 77.1069C216.045 76.8061 215.11 76.3128 214.25 75.6271C213.389 74.9414 212.671 74.0487 212.095 72.949C211.517 71.8526 211.227 70.507 211.227 68.9125V60.5725C211.227 58.9941 211.517 57.6551 212.095 56.5554C212.671 55.4589 213.389 54.5678 214.25 53.8821C215.11 53.1932 216.045 52.6983 217.054 52.3975C218.066 52.1 218.999 51.9512 219.853 51.9512H230.963C232.542 51.9512 233.884 52.2342 234.99 52.8002C236.096 53.3695 236.989 54.0843 237.668 54.9446C238.344 55.805 238.838 56.7414 239.148 57.7537C239.455 58.7629 239.609 59.7025 239.609 60.5725ZM233.447 68.9125V60.621C233.447 59.7672 233.236 59.1348 232.812 58.7241C232.385 58.3133 231.769 58.1079 230.963 58.1079H219.897C219.075 58.1079 218.453 58.3181 218.029 58.7386C217.602 59.1559 217.389 59.7672 217.389 60.5725V68.9125C217.389 69.7178 217.602 70.334 218.029 70.7609C218.453 71.1847 219.075 71.3965 219.897 71.3965H230.963C231.798 71.3965 232.421 71.1847 232.831 70.7609C233.242 70.334 233.447 69.7178 233.447 68.9125ZM269.598 68.9125C269.598 69.9701 269.464 70.921 269.196 71.7652C268.927 72.6094 268.573 73.3517 268.133 73.9921C267.69 74.6325 267.176 75.1775 266.59 75.6271C266.005 76.0767 265.394 76.4438 264.756 76.7284C264.116 77.0131 263.468 77.2217 262.811 77.3543C262.158 77.4901 261.538 77.5581 260.953 77.5581H244.278V71.3965H260.904C261.742 71.3965 262.374 71.1847 262.801 70.7609C263.228 70.334 263.442 69.7178 263.442 68.9125C263.361 67.2694 262.531 66.4478 260.953 66.4478H251.405C250.046 66.4478 248.893 66.2101 247.946 65.7347C246.998 65.2624 246.228 64.6705 245.636 63.959C245.044 63.2506 244.619 62.4857 244.36 61.6641C244.098 60.8426 243.967 60.076 243.967 59.3645C243.967 57.9898 244.211 56.8335 244.7 55.8956C245.191 54.9543 245.808 54.191 246.548 53.6056C247.292 53.0234 248.098 52.6013 248.964 52.3393C249.834 52.0806 250.648 51.9512 251.405 51.9512H266.542V58.1079H251.453C251.136 58.1079 250.887 58.1435 250.706 58.2146C250.525 58.2858 250.391 58.3812 250.303 58.5009C250.216 58.6173 250.164 58.7435 250.148 58.8793C250.135 59.0119 250.129 59.1413 250.129 59.2674C250.142 59.523 250.189 59.7219 250.269 59.8642C250.347 60.0033 250.446 60.1052 250.565 60.1698C250.685 60.2345 250.819 60.2701 250.968 60.2766C251.117 60.2831 251.262 60.2863 251.405 60.2863H260.953C262.531 60.2863 263.873 60.5709 264.98 61.1402C266.086 61.7094 266.978 62.4242 267.658 63.2846C268.337 64.1449 268.83 65.0813 269.137 66.0937C269.445 67.1028 269.598 68.0424 269.598 68.9125Z"
                fill="white"
              />
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M253.701 33.3055L263.344 40.8021C267.144 35.8951 271.081 32.391 275.537 28.2479C278.037 25.9234 281.682 18.3365 276.589 14.3768C271.495 10.4171 265.273 14.2806 263.499 17.198L253.701 33.3055ZM251.714 35.434L261.632 43.1447L259.858 45.4264C257.585 48.3507 253.733 49.2084 250.782 46.9494C247.822 44.702 247.649 40.7539 249.879 37.7952L251.714 35.434ZM288.807 47.1327L279.164 39.6361C282.982 34.7434 285.407 30.0642 288.324 24.7241C289.96 21.7279 296.414 16.3245 301.507 20.2842C306.601 24.244 304.391 31.2268 302.001 33.6657L288.807 47.1327ZM277.315 41.8717L287.233 49.5824L285.459 51.8641C283.185 54.7885 279.333 55.6461 276.382 53.3872C273.422 51.1399 273.25 47.1916 275.48 44.2329L277.315 41.8717Z"
                fill="white"
              />
              <path
                d="M61.9608 7.99385C62.5531 9.0601 62.8493 10.193 62.8493 11.3925C62.8493 12.5921 62.5531 13.7324 61.9608 14.8134L24.4421 79.2105H8.75931L44.2566 18.0788H0.42923V4.55075H56.0964C57.3107 4.55075 58.4436 4.85434 59.4951 5.46151C60.5613 6.06868 61.3832 6.91279 61.9608 7.99385Z"
                fill="white"
              />
              <path
                d="M73.1233 5.64078L73.9143 78.1632L71.5747 78.1888L70.7837 5.6663L73.1233 5.64078Z"
                fill="#fff"
              />
            </svg>
          </Navbar.Brand>
          <Form className="d-none col-lg-6 d-lg-flex">
            <Form.Group className="w-100" controlId="formBasicEmail">
              <Form.Control type="text" placeholder="Buscar.." />
            </Form.Group>
            <Button className="btn-pesquisar" variant="primary" type="submit">
              Pesquisar
            </Button>
          </Form>
          <div className="d-lg-none lupa">
            <button onClick={toogleLupa}>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 16 16"
                fill="none"
              >
                <path
                  d="M15.4141 12.5859L12.2842 9.45506C12.7383 8.56788 13 7.56544 13 6.5C13 2.91016 10.0898 0 6.5 0C2.90966 0 0 2.91016 0 6.5C0 10.0898 2.90966 13 6.5 13C7.56103 13 8.55956 12.7403 9.44434 12.29C9.44337 12.29 9.44141 12.291 9.44044 12.292C9.44531 12.289 9.45119 12.2871 9.45703 12.2842L12.5859 15.4141C13.3682 16.1953 14.6348 16.1953 15.4141 15.4141C16.1953 14.6338 16.1953 13.3672 15.4141 12.5859ZM1.5 6.5C1.5 3.74316 3.74316 1.5 6.5 1.5C9.25684 1.5 11.5 3.74316 11.5 6.5C11.5 9.25684 9.25684 11.5 6.5 11.5C3.74316 11.5 1.5 9.25684 1.5 6.5ZM14.3535 13.6455C14.1582 13.8408 13.8418 13.8408 13.6465 13.6455L12.2324 12.2314C12.0371 12.0361 12.0371 11.7197 12.2324 11.5244C12.4277 11.3291 12.7441 11.3291 12.9394 11.5244L14.3535 12.9385C14.5498 13.1338 14.5498 13.4502 14.3535 13.6455Z"
                  fill="white"
                />
              </svg>
            </button>

            <Navbar.Toggle aria-controls="basic-navbar-nav" />
          </div>
          <Navbar.Collapse id="basic-navbar-nav">
            <Nav className="me-auto">
              {usuarioLogado === false && (
                <Nav.Link className="bonecoentrar" href="/entrar">
                  <svg
                    width="40"
                    height="40"
                    viewBox="0 0 48 48"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fillRule="evenodd"
                      clipRule="evenodd"
                      d="M24 42C33.9411 42 42 33.9411 42 24C42 14.0589 33.9411 6 24 6C14.0589 6 6 14.0589 6 24C6 33.9411 14.0589 42 24 42ZM24 44C35.0457 44 44 35.0457 44 24C44 12.9543 35.0457 4 24 4C12.9543 4 4 12.9543 4 24C4 35.0457 12.9543 44 24 44Z"
                      fill="white"
                    />
                    <path
                      d="M12 35.6309C12 34.5972 12.772 33.7241 13.7995 33.6103C21.515 32.7559 26.5206 32.8325 34.218 33.6287C35.2324 33.7337 36 34.5918 36 35.6116C36 36.1807 35.7551 36.7275 35.3262 37.1014C26.2414 45.0195 21.0488 44.9103 12.6402 37.1087C12.2306 36.7286 12 36.1897 12 35.6309Z"
                      fill="white"
                    />
                    <path
                      fillRule="evenodd"
                      clipRule="evenodd"
                      d="M34.1151 34.6234C26.4784 33.8334 21.5449 33.7587 13.9095 34.6042C13.3954 34.6612 13 35.1002 13 35.6309C13 35.9171 13.1187 36.1885 13.3204 36.3757C17.4879 40.2423 20.6461 41.9887 23.7333 41.9999C26.8309 42.0113 30.1592 40.2783 34.6691 36.3476C34.8767 36.1667 35 35.8964 35 35.6116C35 35.0998 34.6154 34.6752 34.1151 34.6234ZM13.6894 32.6164C21.4852 31.7531 26.5628 31.8315 34.3209 32.6341C35.8495 32.7922 37 34.0838 37 35.6116C37 36.465 36.6336 37.2884 35.9832 37.8553C31.4083 41.8426 27.598 44.0141 23.726 43.9999C19.8435 43.9857 16.2011 41.7767 11.9601 37.8418C11.3425 37.2688 11 36.4624 11 35.6309C11 34.0943 12.1487 32.787 13.6894 32.6164Z"
                      fill="white"
                    />
                    <path
                      d="M32 20C32 24.4183 28.4183 28 24 28C19.5817 28 16 24.4183 16 20C16 15.5817 19.5817 12 24 12C28.4183 12 32 15.5817 32 20Z"
                      fill="white"
                    />
                    <path
                      fillRule="evenodd"
                      clipRule="evenodd"
                      d="M24 26C27.3137 26 30 23.3137 30 20C30 16.6863 27.3137 14 24 14C20.6863 14 18 16.6863 18 20C18 23.3137 20.6863 26 24 26ZM24 28C28.4183 28 32 24.4183 32 20C32 15.5817 28.4183 12 24 12C19.5817 12 16 15.5817 16 20C16 24.4183 19.5817 28 24 28Z"
                      fill="white"
                    />
                  </svg>
                  Entrar
                </Nav.Link>
              )}
              {/* Checar tomorrow */}
              {adminLogado === true && <Nav.Link href="/admin">Admin</Nav.Link>}
              {usuarioLogado === true && (
                <Nav.Link onClick={deslogar} href="/">
                  {usuarioLogado.nomeCliente}
                  Sair
                </Nav.Link>
              )}

              <Nav.Link className="icone-carrinho" href="/carrinho">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="28"
                  height="28"
                  viewBox="0 0 16 15"
                  fill="white"
                >
                  <path
                    d="M14 12.1V11H4.6L5.2 9.9L14.4 9L16 3H3.7L3 0H0V1H2.2L4.3 9.4L3 12V13.5C3 14.3 3.7 15 4.5 15C5.3 15 6 14.3 6 13.5C6 12.7 5.3 12 4.5 12H12V13.5C12 14.3 12.7 15 13.5 15C14.3 15 15 14.3 15 13.5C15 12.8 14.6 12.3 14 12.1ZM4 4H14.7L13.6 8L5.2 8.9L4 4Z"
                    fill="white"
                  />
                </svg>{" "}
                {contadorTotalCarrinho > 0 && (
                  <span>{contadorTotalCarrinho}</span>
                )}
              </Nav.Link>

              <NavDropdown
                title="Categorias"
                className="d-lg-none"
                id="basic-nav-dropdown"
              >
                <NavDropdown.Item href="/produtos/esporte">
                  Esporte
                </NavDropdown.Item>
                <NavDropdown.Item href="/produtos/casual">
                  Casual
                </NavDropdown.Item>
                <NavDropdown.Item href="/produtos/sandalia">
                  Sand√°lia
                </NavDropdown.Item>
                <NavDropdown.Item href="/produtos/bota">Bota</NavDropdown.Item>
              </NavDropdown>
            </Nav>
          </Navbar.Collapse>
        </Container>
      </Navbar>
      <BarraCategoria className="d-none d-lg-flex" />
      {lupaAberta && (
        <div className="pesquisa-mobile">
          <Container>
            <Form className="col-lg-12 d-flex d-lg-none">
              <Form.Group className="w-100" controlId="formBasicEmail">
                <Form.Control type="text" placeholder="Buscar.." />
              </Form.Group>
              <Button variant="primary" type="submit">
                Pesquisar
              </Button>
            </Form>
          </Container>
        </div>
      )}
    </>
  );
};
